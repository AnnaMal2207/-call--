# 4 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: call-–æ–ø—Ü–∏–æ–Ω
#1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å {ùêµùëõ} –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏ ùëü = 0.01, 
#–∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É–ª—É (5), –∑–∞ –ø–µ—Ä–∏–æ–¥ ùëÅ = 200 –ø—Ä–∏ ùêµ0 = 1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫
B_0 = 1
N = 200
r = 0.01

S_0 = 1
a = -0.3
b = 0.8
p = 0.4
q = 1 - p

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω
ro <- sample(c(a, b), N, replace = TRUE, prob = c(q, p))
ro
r=rbinom(N,1,p)
r
r[r==1]<-b
r[r==0]<-a
r
# –í—ã—á–∏—Å–ª—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ B_n –∏ S_n
B_n = numeric(N);B_n 
S_n = numeric(N);S_n
B_n[1] = B_0
S_n[1] = S_0
for (i in 2:N) {B_n[i] = (1 + r) * B_n[i-1]
                S_n[i] = (1 + ro[i]) * S_n[i-1]
                }
plot(B_n,type="l",col="blue")
plot(S_n,type="l",col="violet")
plot(B_n, type="l", col="blue", ylim=c(0, max(B_n, S_n)))
lines(S_n, type="l", col="red")
legend("topleft", legend=c("Bn", "Sn"), col=c("blue", "red"), lty=1)

#3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—É—é —Ü–µ–Ω—É ùëêùëéùëôùëô-–æ–ø—Ü–∏–æ–Ω–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ (7) –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: 
#ùëÜ0 = 100, ùëÅ = 10, ùëé = ‚àí0.3, ùëè = 0.8, ùëü = 0.2,ùêæ = 100.
S_0 = 100
N = 10
a = -0.3
b = 0.8
r = 0.2
K = 100

#–∑–Ω–∞—á–µ–Ω–∏—è K0, p* –∏ p~
K_0 = 1 + ((log(K / (S_0*((1+a)^N)))) * ((log((1 + b)/(1 + a)))^(-1)))
K_0
p_1 = (1 + b) / (1 + r)
p_1
p_2 = (r - a) / (b - a)
p_2

#–ó–Ω–∞—á–µ–Ω–∏–µ B(K0, N; p*)
B_K0_N_p1 = 0
if (p_1 > 1) {p_1 = 1}
for (k in K_0:N) {B_K0_N_p1 = B_K0_N_p1 + dbinom(round(k), N, p_1) * S_0}
B_K0_N_p1

#–ó–Ω–∞—á–µ–Ω–∏–µ B(K0, N; p~)
B_K0_N_p_2 = 0
if (p_2 > 1) {p_2 = 1}
for (k in K_0:N) {B_K0_N_p_2 = B_K0_N_p_2 + dbinom(round(k), N, p_2) * S_0}
B_K0_N_p_2 = B_K0_N_p_2 * K * exp(-r * N)
B_K0_N_p_2
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—É—é —Ü–µ–Ω—É –æ–ø—Ü–∏–æ–Ω–∞
if (K_0 <= N) {C_N = B_K0_N_p1 - K * ((1 + r)^(-N)) * B_K0_N_p_2} else {C_N = 0}

print(C_N)